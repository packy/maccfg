#!/usr/bin/env bash

FILE="${@: -1}"

TMP=/tmp/xless_$$.sh

echo FILE=$FILE > $TMP
echo "printf '\e]0;%s\007' \"less $@\"" >> $TMP
echo "while [ ! -f \$FILE ]; do sleep 1; done" >> $TMP
echo "less +F $@" >> $TMP
echo "rm -f $TMP" >> $TMP
chmod +x $TMP

osascript \
  -e 'tell application "iTerm2"' \
  -e "set newWindow to (create window with default profile command \"$TMP\")" \
  -e 'end tell'
